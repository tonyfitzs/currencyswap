<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0A0F2C" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Convertr - Know What It Costs</title>
  
  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Color Palette Variables */
    :root {
      --primary-blue: #007AFF;
      --midnight-blue: #0A0F2C;
      --glow-cyan: #00F0FF;
      --rich-white: #F8F9FA;
      --soft-grey: #DDE2E6;
      --deep-charcoal: #1C1C1E;
      --accent-green: #30D158;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--midnight-blue);
      color: var(--rich-white);
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    /* ===== SPLASH SCREEN ===== */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--midnight-blue);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .splash-container {
      position: relative;
      width: 280px;
      height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Diagonal glowing slash */
    .diagonal-slash {
      position: absolute;
      width: 6px;
      height: 400px;
      background: linear-gradient(180deg, 
        transparent 0%, 
        var(--glow-cyan) 20%, 
        var(--glow-cyan) 80%, 
        transparent 100%);
      transform: rotate(45deg);
      box-shadow: 
        0 0 20px var(--glow-cyan),
        0 0 40px var(--glow-cyan),
        0 0 60px rgba(0, 240, 255, 0.5);
      opacity: 0.8;
      z-index: 2;
      animation: slashGlow 0.5s ease-in-out 1.5s forwards, slashPulse 0.6s ease-in-out 2s;
    }

    @keyframes slashGlow {
      0% {
        opacity: 0.8;
        box-shadow: 
          0 0 20px var(--glow-cyan),
          0 0 40px var(--glow-cyan),
          0 0 60px rgba(0, 240, 255, 0.5);
      }
      100% {
        opacity: 0.9;
        box-shadow: 
          0 0 25px var(--glow-cyan),
          0 0 50px var(--glow-cyan),
          0 0 75px rgba(0, 240, 255, 0.6);
      }
    }

    @keyframes slashPulse {
      0%, 100% {
        opacity: 0.9;
        box-shadow: 
          0 0 25px var(--glow-cyan),
          0 0 50px var(--glow-cyan),
          0 0 75px rgba(0, 240, 255, 0.6);
      }
      50% {
        opacity: 1;
        box-shadow: 
          0 0 35px var(--glow-cyan),
          0 0 70px var(--glow-cyan),
          0 0 100px rgba(0, 240, 255, 0.9);
      }
    }

    /* Currency symbols container */
    .currency-container {
      position: relative;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .currency-top,
    .currency-bottom {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      font-size: 56px;
      font-weight: 600;
      color: var(--glow-cyan);
      text-shadow: 
        0 0 15px var(--glow-cyan),
        0 0 30px rgba(0, 240, 255, 0.5);
      white-space: nowrap;
      z-index: 1;
    }

    .currency-top {
      top: 15px;
      flex-direction: row;
    }

    .currency-bottom {
      bottom: 15px;
      flex-direction: row;
    }

    .currency-symbol {
      display: inline-block;
      min-width: 40px;
      text-align: center;
      opacity: 0;
      animation: symbolFadeIn 0.3s ease-out forwards;
    }

    @keyframes symbolFadeIn {
      from {
        opacity: 0;
        transform: scale(0.5);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .currency-symbol.final {
      animation: symbolResolve 0.4s ease-out forwards;
    }

    @keyframes symbolResolve {
      0% {
        transform: scale(1.2) rotate(5deg);
      }
      50% {
        transform: scale(0.9) rotate(-5deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    /* App icon that zooms out and slides up */
    .splash-icon-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      z-index: 3;
      animation: iconZoomOut 1.2s cubic-bezier(0.4, 0, 0.2, 1) 2.2s forwards;
    }

    @keyframes iconZoomOut {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -180%) scale(0.35);
        opacity: 0.6;
      }
      100% {
        transform: translate(-50%, -250%) scale(0.2);
        opacity: 0;
      }
    }

    .splash-icon {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 240, 255, 0.1);
      border-radius: 24px;
      border: 2px solid var(--glow-cyan);
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
    }

    .splash-icon svg {
      width: 80%;
      height: 80%;
    }

    /* App name and tagline */
    .splash-app-name {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: 700;
      color: var(--rich-white);
      letter-spacing: -1px;
      opacity: 0;
      z-index: 4;
      animation: appNameFadeIn 0.8s ease-out 3.2s forwards;
    }

    @keyframes appNameFadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -40%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .splash-tagline {
      position: absolute;
      top: calc(50% + 50px);
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      font-weight: 300;
      color: var(--glow-cyan);
      opacity: 0;
      z-index: 4;
      animation: taglineFadeIn 0.8s ease-out 3.5s forwards;
      text-align: center;
      width: 90%;
      max-width: 300px;
    }

    @keyframes taglineFadeIn {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Splash screen hide */
    #splashScreen.hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease-out;
    }

    /* Responsive adjustments for splash */
    @media (max-width: 480px) {
      .splash-container {
        width: 240px;
        height: 240px;
      }

      .currency-top,
      .currency-bottom {
        font-size: 44px;
        gap: 6px;
      }

      .currency-symbol {
        min-width: 32px;
      }

      .splash-app-name {
        font-size: 40px;
      }

      .splash-tagline {
        font-size: 16px;
        top: calc(50% + 45px);
      }

      .diagonal-slash {
        height: 350px;
      }

      .splash-icon-container {
        width: 100px;
        height: 100px;
      }
    }

    @media (min-width: 481px) and (max-width: 767px) {
      .splash-container {
        width: 280px;
        height: 280px;
      }
    }

    @media (min-width: 768px) {
      .splash-container {
        width: 320px;
        height: 320px;
      }

      .currency-top,
      .currency-bottom {
        font-size: 64px;
        gap: 10px;
      }

      .splash-app-name {
        font-size: 56px;
      }

      .splash-icon-container {
        width: 140px;
        height: 140px;
      }
    }

    /* iOS safe area support */
    @supports (padding: max(0px)) {
      #splashScreen {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
    }

    /* ===== MAIN APP UI ===== */
    #mainApp {
      display: none;
      min-height: 100vh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      background: var(--midnight-blue);
      color: var(--rich-white);
    }

    #mainApp.visible {
      display: block;
    }

    .app-header {
      background: var(--midnight-blue); /* #0A0F2C - dark blue background */
      color: var(--rich-white); /* #F8F9FA - high contrast white text */
      padding: 16px 20px;
      position: relative;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 16px;
      min-height: 64px;
      /* Touch-optimized: ensure minimum 44px touch targets */
      padding-top: max(16px, env(safe-area-inset-top));
      /* Ensure header stays on top */
      z-index: 10;
    }

    /* App icon in top left - light/dark based on system preference */
    .app-header-icon {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      flex-shrink: 0;
      opacity: 0;
      transform: scale(0);
      animation: headerIconAppear 0.5s ease-out 3.4s forwards;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: rgba(0, 122, 255, 0.1);
      border: 1px solid rgba(0, 122, 255, 0.2);
    }

    /* Light icon (default) */
    .app-header-icon svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .app-header-icon svg.light-icon {
      display: block;
    }

    .app-header-icon svg.dark-icon {
      display: none;
    }

    /* Dark icon for dark mode preference */
    @media (prefers-color-scheme: dark) {
      .app-header-icon svg.light-icon {
        display: none;
      }

      .app-header-icon svg.dark-icon {
        display: block;
      }
    }

    @keyframes headerIconAppear {
      from {
        opacity: 0;
        transform: scale(0) translateY(-10px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .app-header-content {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      flex: 1;
      min-width: 0; /* Allow text truncation */
    }

    .app-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      padding: 0;
      letter-spacing: -0.5px;
      color: var(--rich-white);
      opacity: 0;
      animation: fadeIn 0.5s ease-in 4s forwards;
      line-height: 1.2;
    }

    .app-header .tagline {
      font-size: 13px;
      color: var(--glow-cyan);
      font-weight: 400;
      opacity: 0;
      animation: fadeIn 0.5s ease-in 4.2s forwards;
      line-height: 1.3;
      margin-top: 2px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    /* Center layout for phones, split layout for tablets */
    .conversion-wrapper {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    @media (min-width: 768px) {
      .conversion-wrapper {
        flex-direction: row;
        align-items: flex-start;
        gap: 32px;
      }

      .conversion-wrapper > * {
        flex: 1;
      }
    }

    .conversion-card {
      background: rgba(248, 249, 250, 0.05);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 20px;
      border: 1px solid rgba(221, 226, 230, 0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .input-group {
      margin-bottom: 28px;
    }

    .input-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .input-wrapper {
      position: relative;
    }

    .currency-input-prefix {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 32px;
      font-weight: 600;
      color: var(--glow-cyan);
      pointer-events: none;
      z-index: 1;
    }

    .currency-input {
      width: 100%;
      padding: 18px 20px 18px 60px;
      font-size: 32px;
      font-weight: 600;
      border: 2px solid rgba(221, 226, 230, 0.2);
      border-radius: 16px;
      background: rgba(248, 249, 250, 0.08);
      color: var(--rich-white); /* #F8F9FA - high contrast white text */
      transition: all 0.3s ease;
      /* Touch-optimized: ensure adequate touch target */
      min-height: 56px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.1);
      touch-action: manipulation;
    }

    .currency-input::placeholder {
      color: rgba(248, 249, 250, 0.3);
    }

    .currency-input:focus {
      outline: none;
      border-color: var(--primary-blue); /* #007AFF */
      background: rgba(248, 249, 250, 0.12);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .currency-input:focus-visible {
      outline: 2px solid var(--glow-cyan); /* #00F0FF */
      outline-offset: 2px;
    }

    .output-group {
      margin-top: 32px;
      padding-top: 28px;
      border-top: 1px solid rgba(221, 226, 230, 0.15);
    }

    .output-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .output-value {
      font-size: 40px;
      font-weight: 700;
      color: var(--rich-white); /* #F8F9FA - high contrast white text */
      margin-top: 12px;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
      text-shadow: 0 0 20px rgba(0, 240, 255, 0.2); /* Subtle glow accent */
    }

    .output-value.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .output-value.live-rate {
      animation: conversionPulse 0.6s ease-out;
    }

    @keyframes conversionPulse {
      0% {
        transform: scale(1);
        text-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      }
      50% {
        transform: scale(1.05);
        text-shadow: 0 0 40px rgba(0, 240, 255, 0.5); /* Accent glow on pulse */
      }
      100% {
        transform: scale(1);
        text-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      }
    }

    /* Exchange rate display */
    .exchange-rate {
      margin-top: 16px;
      padding: 12px 16px;
      background: rgba(0, 122, 255, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(0, 122, 255, 0.2);
      font-size: 13px;
      color: var(--soft-grey);
      display: flex;
      align-items: center;
      justify-content: space-between;
      opacity: 0;
      transform: translateY(5px);
      transition: all 0.3s ease 0.2s;
    }

    .exchange-rate.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .exchange-rate-label {
      font-weight: 500;
      color: var(--soft-grey);
    }

    .exchange-rate-value {
      font-weight: 600;
      color: var(--glow-cyan);
      font-size: 14px;
    }

    .exchange-rate-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 8px;
    }

    .exchange-rate-badge.live {
      background: var(--accent-green);
      color: white;
    }

    .exchange-rate-badge.cached {
      background: rgba(221, 226, 230, 0.3);
      color: var(--soft-grey);
    }

    .change-currency-btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      background: var(--primary-blue); /* #007AFF */
      color: var(--rich-white); /* #F8F9FA - high contrast white */
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 24px;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
      /* Touch-optimized: minimum 44px height */
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
    }

    .change-currency-btn:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
      background: #0056CC; /* Darker blue on press */
    }

    .change-currency-btn:hover {
      background: #0056CC;
      box-shadow: 0 6px 16px rgba(0, 122, 255, 0.4);
    }

    /* Focus state for accessibility */
    .change-currency-btn:focus-visible {
      outline: 2px solid var(--glow-cyan); /* #00F0FF */
      outline-offset: 2px;
    }

    .status-badge {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 13px;
      font-weight: 600;
      background: rgba(28, 28, 30, 0.9);
      color: var(--rich-white);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      z-index: 100;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(221, 226, 230, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      display: inline-block;
    }

    .status-badge.online {
      background: rgba(48, 209, 88, 0.9);
      color: white;
    }

    .status-badge.offline {
      background: rgba(255, 59, 48, 0.9);
      color: white;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      .app-header {
        padding: 14px 16px;
        gap: 12px;
        min-height: 56px;
      }

      .app-header-icon {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
      }

      .app-header h1 {
        font-size: 22px;
      }

      .app-header .tagline {
        font-size: 12px;
      }

      .currency-input {
        font-size: 28px;
        padding: 16px 18px 16px 50px;
      }

      .currency-input-prefix {
        font-size: 28px;
        left: 18px;
      }

      .output-value {
        font-size: 36px;
      }

      .conversion-card {
        padding: 24px;
      }

      .app-container {
        padding: 20px 16px;
      }

      .status-badge {
        bottom: 20px;
        padding: 10px 20px;
        font-size: 12px;
      }
    }

    @media (min-width: 481px) and (max-width: 767px) {
      .app-container {
        padding: 24px;
      }
    }

    @media (min-width: 768px) {
      .app-header {
        padding: 20px 32px;
        min-height: 72px;
      }

      .app-header-icon {
        width: 48px;
        height: 48px;
        min-width: 48px;
        min-height: 48px;
      }

      .app-header h1 {
        font-size: 28px;
      }

      .app-header .tagline {
        font-size: 14px;
      }

      .app-container {
        padding: 40px 32px;
      }

      .conversion-card {
        padding: 36px;
      }

      .currency-input {
        font-size: 36px;
        padding: 20px 24px 20px 70px;
      }

      .currency-input-prefix {
        font-size: 36px;
        left: 24px;
      }

      .output-value {
        font-size: 48px;
      }

      .status-badge {
        bottom: 32px;
      }
    }

    @media (min-width: 1024px) {
      .conversion-wrapper {
        max-width: 1000px;
        margin: 0 auto;
      }
    }
  </style>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splashScreen">
    <div class="splash-container">
      <!-- Diagonal glowing slash -->
      <div class="diagonal-slash"></div>

      <!-- Currency symbols above and below -->
      <div class="currency-container">
        <div class="currency-top" id="currencyTop">
          <span class="currency-symbol">$</span>
          <span class="currency-symbol">€</span>
          <span class="currency-symbol">¥</span>
          <span class="currency-symbol">£</span>
          <span class="currency-symbol">₹</span>
        </div>
        <div class="currency-bottom" id="currencyBottom">
          <span class="currency-symbol">₩</span>
          <span class="currency-symbol">₽</span>
          <span class="currency-symbol">₪</span>
          <span class="currency-symbol">₱</span>
          <span class="currency-symbol">zł</span>
        </div>
      </div>

      <!-- App icon that zooms out and slides up -->
      <div class="splash-icon-container">
        <div class="splash-icon">
          <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="var(--glow-cyan)" stroke-width="4" fill="none"/>
            <circle cx="100" cy="100" r="30" stroke="var(--glow-cyan)" stroke-width="4" fill="none"/>
          </svg>
        </div>
      </div>

      <!-- App name -->
      <div class="splash-app-name">Convertr</div>
    </div>

    <div class="splash-tagline">Know What It Costs.</div>
  </div>

  <!-- Main App -->
  <div id="mainApp">
    <header class="app-header">
      <!-- App icon in top left - light/dark variants -->
      <div class="app-header-icon" id="headerIcon" role="img" aria-label="Convertr app icon">
        <!-- Light icon (for light mode) -->
        <svg class="light-icon" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="#007AFF" stroke-width="4" fill="none"/>
          <circle cx="100" cy="100" r="30" stroke="#007AFF" stroke-width="4" fill="none"/>
        </svg>
        <!-- Dark icon (for dark mode) -->
        <svg class="dark-icon" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="#00F0FF" stroke-width="4" fill="none"/>
          <circle cx="100" cy="100" r="30" stroke="#00F0FF" stroke-width="4" fill="none"/>
        </svg>
      </div>
      <!-- App branding: title and subtitle -->
      <div class="app-header-content">
        <h1>Convertr</h1>
        <div class="tagline">Know What It Costs.</div>
      </div>
    </header>

    <div class="app-container">
      <div class="conversion-wrapper">
        <div class="conversion-card">
          <div class="input-group">
            <label id="inputLabel">Amount in <span id="localCurrency">EUR</span></label>
            <div class="input-wrapper">
              <span class="currency-input-prefix" id="inputCurrencySymbol">€</span>
              <input 
                type="number" 
                id="amountInput" 
                class="currency-input" 
                placeholder="0.00"
                step="0.01"
                min="0"
                inputmode="decimal"
              />
            </div>
          </div>

          <div class="output-group">
            <label>Amount in <span id="homeCurrency">USD</span></label>
            <div class="output-value" id="outputValue">--</div>
            <!-- Exchange rate display -->
            <div class="exchange-rate" id="exchangeRate">
              <span class="exchange-rate-label">Exchange Rate</span>
              <span>
                <span class="exchange-rate-value" id="exchangeRateValue">--</span>
                <span class="exchange-rate-badge cached" id="rateBadge">Cached</span>
              </span>
            </div>
          </div>

          <button class="change-currency-btn" id="changeCurrencyBtn">
            Change Home Currency
          </button>
        </div>
      </div>
    </div>

    <div class="status-badge offline" id="statusBadge">Cached</div>
  </div>

  <script>
    // ===== STATE MANAGEMENT =====
    let homeCurrency = localStorage.getItem('homeCurrency') || 'USD';
    let localCurrency = localStorage.getItem('localCurrency') || 'EUR';
    let isOnline = false;
    let failCount = 0;

    // Currency symbols mapping
    const currencySymbols = {
      'USD': '$', 'EUR': '€', 'GBP': '£', 'JPY': '¥', 'AUD': 'A$',
      'CAD': 'C$', 'CHF': 'Fr', 'CNY': '¥', 'INR': '₹', 'KRW': '₩',
      'MXN': '$', 'BRL': 'R$', 'SGD': 'S$', 'HKD': 'HK$', 'NZD': 'NZ$',
      'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr', 'PLN': 'zł', 'RUB': '₽',
      'TRY': '₺', 'ZAR': 'R', 'THB': '฿', 'MYR': 'RM', 'IDR': 'Rp',
      'PHP': '₱', 'VND': '₫', 'ILS': '₪'
    };

    // ===== SPLASH SCREEN ANIMATION =====
    function initializeSplashScreen() {
      const topContainer = document.getElementById('currencyTop');
      const bottomContainer = document.getElementById('currencyBottom');
      const topSymbols = ['$', '€', '¥', '£', '₹'];
      const bottomSymbols = ['₩', '₽', '₪', '₱', 'zł'];
      
      // Get final currency symbols
      const finalTopSymbol = currencySymbols[homeCurrency] || '$';
      const finalBottomSymbol = currencySymbols[localCurrency] || '€';
      
      // Initial display - show all symbols
      topContainer.innerHTML = topSymbols.map(s => 
        `<span class="currency-symbol">${s}</span>`
      ).join('');
      bottomContainer.innerHTML = bottomSymbols.map(s => 
        `<span class="currency-symbol">${s}</span>`
      ).join('');
      
      // Fade in all symbols first
      setTimeout(() => {
        const symbols = topContainer.querySelectorAll('.currency-symbol');
        symbols.forEach((sym, idx) => {
          sym.style.animationDelay = `${idx * 0.05}s`;
        });
        const bottomSymbols = bottomContainer.querySelectorAll('.currency-symbol');
        bottomSymbols.forEach((sym, idx) => {
          sym.style.animationDelay = `${idx * 0.05}s`;
        });
      }, 100);
      
      // Start shuffle animation after symbols appear (0.75s shuffle duration)
      setTimeout(() => {
        let shuffleCount = 0;
        const shuffleInterval = setInterval(() => {
          // Randomly shuffle visible symbols
          const topSymbolsShuffled = [...topSymbols].sort(() => Math.random() - 0.5);
          const bottomSymbolsShuffled = [...bottomSymbols].sort(() => Math.random() - 0.5);
          
          topContainer.innerHTML = topSymbolsShuffled.map(s => 
            `<span class="currency-symbol" style="opacity: 1;">${s}</span>`
          ).join('');
          bottomContainer.innerHTML = bottomSymbolsShuffled.map(s => 
            `<span class="currency-symbol" style="opacity: 1;">${s}</span>`
          ).join('');
          
          shuffleCount++;
          if (shuffleCount >= 5) { // 0.75s at 150ms intervals (5 * 150ms = 750ms)
            clearInterval(shuffleInterval);
            
            // Resolve to final currencies
            topContainer.innerHTML = `<span class="currency-symbol final" style="opacity: 1;">${finalTopSymbol}</span>`;
            bottomContainer.innerHTML = `<span class="currency-symbol final" style="opacity: 1;">${finalBottomSymbol}</span>`;
          }
        }, 150);
      }, 500); // Wait for initial fade-in to complete
      
      // Hide splash and show main app after animation completes
      // Timeline: 0.5s fade-in + 0.75s shuffle + 0.4s resolve + 0.5s glow + 1.2s zoom + 0.8s fade = ~4.15s
      setTimeout(() => {
        document.getElementById('splashScreen').classList.add('hidden');
        setTimeout(() => {
          document.getElementById('splashScreen').style.display = 'none';
          document.getElementById('mainApp').classList.add('visible');
        }, 600);
      }, 4800); // Total animation duration
    }

    // ===== LOCATION DETECTION =====
    async function detectLocalCurrency() {
      try {
        // TODO: Replace with actual geolocation API call
        // For now, using browser's Intl API as fallback
        const locale = navigator.language || 'en-US';
        const region = locale.split('-')[1] || 'US';
        
        // Simple region to currency mapping (placeholder)
        const regionToCurrency = {
          'US': 'USD', 'GB': 'GBP', 'JP': 'JPY', 'AU': 'AUD',
          'CA': 'CAD', 'CH': 'CHF', 'CN': 'CNY', 'IN': 'INR',
          'KR': 'KRW', 'MX': 'MXN', 'BR': 'BRL', 'SG': 'SGD',
          'HK': 'HKD', 'NZ': 'NZD', 'SE': 'SEK', 'NO': 'NOK',
          'DK': 'DKK', 'PL': 'PLN', 'RU': 'RUB', 'TR': 'TRY',
          'ZA': 'ZAR', 'TH': 'THB', 'MY': 'MYR', 'ID': 'IDR',
          'PH': 'PHP', 'VN': 'VND', 'EU': 'EUR', 'DE': 'EUR',
          'FR': 'EUR', 'IT': 'EUR', 'ES': 'EUR', 'NL': 'EUR'
        };

        const detected = regionToCurrency[region] || 'USD';
        localCurrency = detected;
        localStorage.setItem('localCurrency', localCurrency);
        updateCurrencyLabels();
      } catch (error) {
        console.error('Currency detection failed:', error);
        // Keep default or cached value
      }
    }

    // ===== CONNECTIVITY CHECKING =====
    async function probeInternet() {
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2500);

        const response = await fetch("./healthcheck.txt?t=" + Date.now(), {
          cache: "no-store",
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (response.ok) {
          const text = await response.text();
          if (text.toLowerCase().includes("ok")) {
            return true;
          }
        }
        return false;
      } catch (error) {
        return false;
      }
    }

    async function updateConnectivity(reason) {
      if (!navigator.onLine) {
        isOnline = false;
        failCount = 0;
        updateStatusBadge('offline');
        return;
      }

      const ok = await probeInternet();
      if (ok) {
        isOnline = true;
        failCount = 0;
        updateStatusBadge('online');
      } else {
        failCount++;
        if (failCount >= 2) {
          isOnline = false;
          updateStatusBadge('offline');
        }
      }
    }

    function updateStatusBadge(status) {
      const badge = document.getElementById('statusBadge');
      badge.className = `status-badge ${status}`;
      badge.textContent = status === 'online' ? 'Online' : 'Cached';
      
      // Update exchange rate badge if conversion is displayed
      if (currentExchangeRate !== null) {
        const rateBadgeEl = document.getElementById('rateBadge');
        if (status === 'online') {
          rateBadgeEl.textContent = 'Live';
          rateBadgeEl.className = 'exchange-rate-badge live';
        } else {
          rateBadgeEl.textContent = 'Cached';
          rateBadgeEl.className = 'exchange-rate-badge cached';
        }
      }
    }

    // ===== CURRENCY CONVERSION =====
    let currentExchangeRate = null;
    let lastConversionTime = null;

    function updateCurrencyLabels() {
      document.getElementById('localCurrency').textContent = localCurrency;
      document.getElementById('homeCurrency').textContent = homeCurrency;
      // Update input currency symbol prefix
      const inputSymbolEl = document.getElementById('inputCurrencySymbol');
      if (inputSymbolEl) {
        inputSymbolEl.textContent = currencySymbols[localCurrency] || localCurrency;
      }
    }

    // Update exchange rate display
    function updateExchangeRateDisplay(fromRate, toRate, isLive = false) {
      const exchangeRateEl = document.getElementById('exchangeRate');
      const exchangeRateValueEl = document.getElementById('exchangeRateValue');
      const rateBadgeEl = document.getElementById('rateBadge');
      
      if (!fromRate || !toRate) {
        exchangeRateEl.classList.remove('visible');
        return;
      }

      // Calculate exchange rate (1 unit of local currency = X units of home currency)
      const rate = toRate / fromRate;
      currentExchangeRate = rate;
      
      // Format rate display
      if (rate >= 1) {
        exchangeRateValueEl.textContent = `1 ${localCurrency} = ${rate.toFixed(4)} ${homeCurrency}`;
      } else {
        exchangeRateValueEl.textContent = `1 ${localCurrency} = ${rate.toFixed(6)} ${homeCurrency}`;
      }

      // Update badge
      if (isLive && isOnline) {
        rateBadgeEl.textContent = 'Live';
        rateBadgeEl.className = 'exchange-rate-badge live';
      } else {
        rateBadgeEl.textContent = 'Cached';
        rateBadgeEl.className = 'exchange-rate-badge cached';
      }

      // Show exchange rate with animation
      exchangeRateEl.classList.add('visible');
    }

    async function convertCurrency(amount) {
      const outputValueEl = document.getElementById('outputValue');
      const exchangeRateEl = document.getElementById('exchangeRate');
      
      if (!amount || isNaN(amount) || amount <= 0) {
        outputValueEl.textContent = '--';
        outputValueEl.classList.remove('visible', 'live-rate');
        exchangeRateEl.classList.remove('visible');
        return;
      }

      // TODO: Replace with actual exchange rate API
      // For now, using placeholder rates - in production, fetch from API like:
      // const response = await fetch(`https://api.exchangerate-api.com/v4/latest/USD`);
      // const data = await response.json();
      // const rates = data.rates;
      const rates = {
        'USD': 1.0,
        'EUR': 0.92,
        'GBP': 0.79,
        'JPY': 149.5,
        'AUD': 1.52,
        'CAD': 1.35,
        'CHF': 0.88,
        'CNY': 7.23,
        'INR': 83.12,
        'KRW': 1312.5,
        'MXN': 17.05,
        'BRL': 4.95,
        'SGD': 1.34,
        'HKD': 7.82,
        'NZD': 1.64,
        'SEK': 10.45,
        'NOK': 10.78,
        'DKK': 6.85,
        'PLN': 4.02,
        'RUB': 91.5,
        'TRY': 32.15,
        'ZAR': 18.75,
        'THB': 35.5,
        'MYR': 4.68,
        'IDR': 15650,
        'PHP': 55.8,
        'VND': 24350,
        'ILS': 3.65
      };

      const fromRate = rates[localCurrency] || 1.0;
      const toRate = rates[homeCurrency] || 1.0;

      if (!fromRate || !toRate) {
        outputValueEl.textContent = 'Rate unavailable';
        outputValueEl.classList.remove('visible', 'live-rate');
        exchangeRateEl.classList.remove('visible');
        return;
      }

      // Convert: local -> USD -> home
      const amountInUSD = amount / fromRate;
      const converted = amountInUSD * toRate;

      // Update exchange rate display
      const isLive = isOnline && (Date.now() - (lastConversionTime || 0) < 60000); // Consider live if online and recent
      updateExchangeRateDisplay(fromRate, toRate, isLive);

      // Update output value with animation
      outputValueEl.textContent = `${currencySymbols[homeCurrency] || ''}${converted.toFixed(2)}`;
      
      // Remove previous animation classes
      outputValueEl.classList.remove('visible', 'live-rate');
      
      // Trigger reflow to restart animation
      void outputValueEl.offsetWidth;
      
      // Add fade-in animation
      setTimeout(() => {
        outputValueEl.classList.add('visible');
        
        // Add pulse/bounce effect if using live rate
        if (isLive && isOnline) {
          outputValueEl.classList.add('live-rate');
        }
      }, 10);

      lastConversionTime = Date.now();
    }

    // ===== EVENT LISTENERS =====
    document.getElementById('amountInput').addEventListener('input', (e) => {
      const amount = parseFloat(e.target.value);
      convertCurrency(amount);
    });

    document.getElementById('changeCurrencyBtn').addEventListener('click', () => {
      // TODO: Open currency selection modal
      alert('Currency selection modal - TODO: Implement');
    });

    window.addEventListener("online", () => updateConnectivity("event-online"));
    window.addEventListener("offline", () => updateConnectivity("event-offline"));

    // ===== INITIALIZATION =====
    async function initializeApp() {
      // Detect local currency
      await detectLocalCurrency();
      
      // Update UI
      updateCurrencyLabels();
      
      // Initialize connectivity
      updateConnectivity("startup");
      setInterval(() => updateConnectivity("poll"), 10000);
      
      // Initialize splash screen
      initializeSplashScreen();
    }

    // Start app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
