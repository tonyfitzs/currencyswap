<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0A0F2C" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Convertr - Know What It Costs</title>
  
  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* Color Palette Variables */
    :root {
      --primary-blue: #007AFF;
      --midnight-blue: #0A0F2C;
      --glow-cyan: #00F0FF;
      --rich-white: #F8F9FA;
      --soft-grey: #DDE2E6;
      --deep-charcoal: #1C1C1E;
      --accent-green: #30D158;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--midnight-blue);
      color: var(--rich-white);
      overflow-x: hidden;
      min-height: 100vh;
      position: relative;
    }

    /* ===== SPLASH SCREEN ===== */
    #splashScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--midnight-blue);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .splash-container {
      position: relative;
      width: 280px;
      height: 280px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Diagonal glowing slash */
    .diagonal-slash {
      position: absolute;
      width: 6px;
      height: 400px;
      background: linear-gradient(180deg, 
        transparent 0%, 
        var(--glow-cyan) 20%, 
        var(--glow-cyan) 80%, 
        transparent 100%);
      transform: rotate(45deg);
      box-shadow: 
        0 0 20px var(--glow-cyan),
        0 0 40px var(--glow-cyan),
        0 0 60px rgba(0, 240, 255, 0.5);
      opacity: 0.8;
      z-index: 2;
      animation: slashGlow 0.5s ease-in-out 1.5s forwards, slashPulse 0.6s ease-in-out 2s;
    }

    @keyframes slashGlow {
      0% {
        opacity: 0.8;
        box-shadow: 
          0 0 20px var(--glow-cyan),
          0 0 40px var(--glow-cyan),
          0 0 60px rgba(0, 240, 255, 0.5);
      }
      100% {
        opacity: 0.9;
        box-shadow: 
          0 0 25px var(--glow-cyan),
          0 0 50px var(--glow-cyan),
          0 0 75px rgba(0, 240, 255, 0.6);
      }
    }

    @keyframes slashPulse {
      0%, 100% {
        opacity: 0.9;
        box-shadow: 
          0 0 25px var(--glow-cyan),
          0 0 50px var(--glow-cyan),
          0 0 75px rgba(0, 240, 255, 0.6);
      }
      50% {
        opacity: 1;
        box-shadow: 
          0 0 35px var(--glow-cyan),
          0 0 70px var(--glow-cyan),
          0 0 100px rgba(0, 240, 255, 0.9);
      }
    }

    /* Currency symbols container */
    .currency-container {
      position: relative;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .currency-top,
    .currency-bottom {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      font-size: 56px;
      font-weight: 600;
      color: var(--glow-cyan);
      text-shadow: 
        0 0 15px var(--glow-cyan),
        0 0 30px rgba(0, 240, 255, 0.5);
      white-space: nowrap;
      z-index: 1;
    }

    .currency-top {
      top: 15px;
      flex-direction: row;
    }

    .currency-bottom {
      bottom: 15px;
      flex-direction: row;
    }

    .currency-symbol {
      display: inline-block;
      min-width: 40px;
      text-align: center;
      opacity: 0;
      animation: symbolFadeIn 0.3s ease-out forwards;
    }

    @keyframes symbolFadeIn {
      from {
        opacity: 0;
        transform: scale(0.5);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .currency-symbol.final {
      animation: symbolResolve 0.4s ease-out forwards;
    }

    @keyframes symbolResolve {
      0% {
        transform: scale(1.2) rotate(5deg);
      }
      50% {
        transform: scale(0.9) rotate(-5deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    /* App icon that zooms out and slides up */
    .splash-icon-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      z-index: 3;
      animation: iconZoomOut 1.2s cubic-bezier(0.4, 0, 0.2, 1) 2.2s forwards;
    }

    @keyframes iconZoomOut {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -180%) scale(0.35);
        opacity: 0.6;
      }
      100% {
        transform: translate(-50%, -250%) scale(0.2);
        opacity: 0;
      }
    }

    .splash-icon {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 240, 255, 0.1);
      border-radius: 24px;
      border: 2px solid var(--glow-cyan);
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
    }

    .splash-icon svg {
      width: 80%;
      height: 80%;
    }

    /* App name and tagline */
    .splash-app-name {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: 700;
      color: var(--rich-white);
      letter-spacing: -1px;
      opacity: 0;
      z-index: 4;
      animation: appNameFadeIn 0.8s ease-out 3.2s forwards;
    }

    @keyframes appNameFadeIn {
      from {
        opacity: 0;
        transform: translate(-50%, -40%);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%);
      }
    }

    .splash-tagline {
      position: absolute;
      top: calc(50% + 50px);
      left: 50%;
      transform: translateX(-50%);
      font-size: 18px;
      font-weight: 300;
      color: var(--glow-cyan);
      opacity: 0;
      z-index: 4;
      animation: taglineFadeIn 0.8s ease-out 3.5s forwards;
      text-align: center;
      width: 90%;
      max-width: 300px;
    }

    @keyframes taglineFadeIn {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    /* Splash screen hide */
    #splashScreen.hidden {
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s ease-out;
    }

    /* Responsive adjustments for splash */
    @media (max-width: 480px) {
      .splash-container {
        width: 240px;
        height: 240px;
      }

      .currency-top,
      .currency-bottom {
        font-size: 44px;
        gap: 6px;
      }

      .currency-symbol {
        min-width: 32px;
      }

      .splash-app-name {
        font-size: 40px;
      }

      .splash-tagline {
        font-size: 16px;
        top: calc(50% + 45px);
      }

      .diagonal-slash {
        height: 350px;
      }

      .splash-icon-container {
        width: 100px;
        height: 100px;
      }
    }

    @media (min-width: 481px) and (max-width: 767px) {
      .splash-container {
        width: 280px;
        height: 280px;
      }
    }

    @media (min-width: 768px) {
      .splash-container {
        width: 320px;
        height: 320px;
      }

      .currency-top,
      .currency-bottom {
        font-size: 64px;
        gap: 10px;
      }

      .splash-app-name {
        font-size: 56px;
      }

      .splash-icon-container {
        width: 140px;
        height: 140px;
      }
    }

    /* iOS safe area support */
    @supports (padding: max(0px)) {
      #splashScreen {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
      }
    }

    /* ===== MAIN APP UI ===== */
    #mainApp {
      display: none;
      min-height: 100vh;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      background: var(--midnight-blue);
      color: var(--rich-white);
    }

    #mainApp.visible {
      display: block;
    }

    .app-header {
      background: var(--midnight-blue); /* #0A0F2C - dark blue background */
      color: var(--rich-white); /* #F8F9FA - high contrast white text */
      padding: 16px 20px;
      position: relative;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 16px;
      min-height: 64px;
      /* Touch-optimized: ensure minimum 44px touch targets */
      padding-top: max(16px, env(safe-area-inset-top));
      /* Ensure header stays on top */
      z-index: 10;
    }

    /* Settings gear icon button in top right */
    .settings-star-btn {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: rgba(248, 249, 250, 0.1);
      border: 1px solid rgba(221, 226, 230, 0.2);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-left: auto; /* Push to right */
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
    }

    .settings-star-btn:hover {
      background: rgba(248, 249, 250, 0.15);
      border-color: rgba(221, 226, 230, 0.3);
    }

    .settings-star-btn:active {
      transform: scale(0.95);
      background: rgba(248, 249, 250, 0.2);
    }

    .settings-star-btn svg {
      width: 20px;
      height: 20px;
      stroke: var(--accent-green);
      transition: all 0.2s ease;
    }

    .settings-star-btn:hover svg {
      stroke: var(--glow-cyan);
    }

    /* Light mode styles for settings button */
    body.light-mode .settings-star-btn {
      background: rgba(221, 226, 230, 0.3);
      border-color: var(--soft-grey);
    }

    body.light-mode .settings-star-btn:hover {
      background: rgba(221, 226, 230, 0.4);
    }

    /* App icon in top left - light/dark based on system preference */
    .app-header-icon {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
      flex-shrink: 0;
      opacity: 0;
      transform: scale(0);
      animation: headerIconAppear 0.5s ease-out 3.4s forwards;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      background: rgba(0, 122, 255, 0.1);
      border: 1px solid rgba(0, 122, 255, 0.2);
    }

    /* Light icon (default) */
    .app-header-icon svg {
      width: 100%;
      height: 100%;
      display: block;
    }

    .app-header-icon svg.light-icon {
      display: block;
    }

    .app-header-icon svg.dark-icon {
      display: none;
    }

    /* Dark icon for dark mode preference */
    @media (prefers-color-scheme: dark) {
      .app-header-icon svg.light-icon {
        display: none;
      }

      .app-header-icon svg.dark-icon {
        display: block;
      }
    }

    @keyframes headerIconAppear {
      from {
        opacity: 0;
        transform: scale(0) translateY(-10px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    .app-header-content {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      flex: 1;
      min-width: 0; /* Allow text truncation */
    }

    .app-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      padding: 0;
      letter-spacing: -0.5px;
      color: var(--rich-white);
      opacity: 0;
      animation: fadeIn 0.5s ease-in 4s forwards;
      line-height: 1.2;
    }

    .app-header .tagline {
      font-size: 13px;
      color: var(--glow-cyan);
      font-weight: 400;
      opacity: 0;
      animation: fadeIn 0.5s ease-in 4.2s forwards;
      line-height: 1.3;
      margin-top: 2px;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* ===== GEOLOCATION PERMISSION MODAL ===== */
    .location-permission-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.3s ease;
    }

    .location-permission-modal.active {
      display: flex;
    }

    .location-permission-content {
      background: var(--midnight-blue);
      border-radius: 24px;
      padding: 32px 28px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(221, 226, 230, 0.1);
      animation: slideUp 0.3s ease;
      text-align: center;
    }

    .location-permission-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 122, 255, 0.1);
      border-radius: 50%;
      border: 2px solid var(--primary-blue);
    }

    .location-permission-icon svg {
      width: 36px;
      height: 36px;
      fill: var(--primary-blue);
    }

    .location-permission-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--rich-white);
      margin-bottom: 12px;
    }

    .location-permission-description {
      font-size: 16px;
      color: var(--soft-grey);
      line-height: 1.5;
      margin-bottom: 28px;
    }

    .location-permission-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .location-allow-btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      background: var(--primary-blue);
      color: var(--rich-white);
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
    }

    .location-allow-btn:hover {
      background: #0056CC;
      box-shadow: 0 6px 16px rgba(0, 122, 255, 0.4);
    }

    .location-allow-btn:active {
      transform: scale(0.98);
    }

    .location-skip-btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      font-weight: 500;
      background: transparent;
      color: var(--soft-grey);
      border: 1px solid rgba(221, 226, 230, 0.2);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(221, 226, 230, 0.2);
      touch-action: manipulation;
    }

    .location-skip-btn:hover {
      background: rgba(248, 249, 250, 0.05);
      border-color: rgba(221, 226, 230, 0.4);
    }

    .location-permission-disclaimer {
      margin-top: 24px;
      padding: 16px;
      background: rgba(0, 122, 255, 0.08);
      border-radius: 12px;
      border: 1px solid rgba(0, 122, 255, 0.2);
      text-align: left;
    }

    .location-permission-disclaimer-text {
      font-size: 13px;
      line-height: 1.6;
      color: var(--soft-grey);
    }

    .location-permission-disclaimer-text strong {
      color: var(--rich-white);
      font-weight: 600;
    }

    /* Light mode styles for location permission */
    body.light-mode .location-permission-content {
      background: var(--rich-white);
      color: var(--deep-charcoal);
    }

    body.light-mode .location-permission-title {
      color: var(--deep-charcoal);
    }

    body.light-mode .location-permission-description {
      color: var(--deep-charcoal);
    }

    body.light-mode .location-permission-disclaimer {
      background: rgba(0, 122, 255, 0.05);
      border-color: rgba(0, 122, 255, 0.15);
    }

    body.light-mode .location-skip-btn {
      color: var(--deep-charcoal);
      border-color: var(--soft-grey);
    }

    body.light-mode .location-skip-btn:hover {
      background: rgba(221, 226, 230, 0.2);
    }

    /* ===== SETTINGS MODAL ===== */
    .settings-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn 0.2s ease;
    }

    .settings-modal.active {
      display: flex;
    }

    .settings-modal-content {
      background: var(--midnight-blue);
      border-radius: 20px;
      padding: 28px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(221, 226, 230, 0.1);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .settings-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(221, 226, 230, 0.1);
    }

    .settings-modal-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--rich-white);
      margin: 0;
    }

    .settings-modal-close {
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: rgba(221, 226, 230, 0.1);
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--rich-white);
      font-size: 20px;
      line-height: 1;
    }

    .settings-modal-close:hover {
      background: rgba(221, 226, 230, 0.2);
    }

    .settings-modal-close:active {
      transform: scale(0.95);
    }

    .settings-section {
      margin-bottom: 28px;
    }

    .settings-section:last-child {
      margin-bottom: 0;
    }

    .settings-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--soft-grey);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .settings-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px;
      background: rgba(248, 249, 250, 0.05);
      border-radius: 12px;
      margin-bottom: 12px;
      border: 1px solid rgba(221, 226, 230, 0.1);
      transition: all 0.2s ease;
    }

    .settings-option:last-child {
      margin-bottom: 0;
    }

    .settings-option:hover {
      background: rgba(248, 249, 250, 0.08);
      border-color: rgba(0, 122, 255, 0.3);
    }

    .settings-option-label {
      flex: 1;
      color: var(--rich-white);
      font-size: 16px;
      font-weight: 500;
    }

    .settings-option-value {
      color: var(--soft-grey);
      font-size: 14px;
      margin-right: 12px;
    }

    .settings-btn {
      padding: 12px 20px;
      font-size: 16px;
      font-weight: 600;
      background: var(--primary-blue);
      color: var(--rich-white);
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
    }

    .settings-btn:hover {
      background: #0056CC;
    }

    .settings-btn:active {
      transform: scale(0.98);
    }

    .settings-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .settings-select {
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 500;
      background: rgba(248, 249, 250, 0.1);
      border: 1px solid rgba(221, 226, 230, 0.2);
      border-radius: 10px;
      color: var(--rich-white);
      cursor: pointer;
      transition: all 0.2s ease;
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
    }

    .settings-select:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
    }

    .settings-select option {
      background: var(--midnight-blue);
      color: var(--rich-white);
    }

    .settings-info-text {
      font-size: 13px;
      line-height: 1.6;
      color: var(--soft-grey);
      margin-top: 12px;
      padding: 16px;
      background: rgba(0, 122, 255, 0.08);
      border-radius: 12px;
      border: 1px solid rgba(0, 122, 255, 0.2);
    }

    .settings-info-text strong {
      color: var(--rich-white);
      font-weight: 600;
    }

    body.light-mode .settings-info-text {
      background: rgba(0, 122, 255, 0.05);
      border-color: rgba(0, 122, 255, 0.15);
    }

    body.light-mode .settings-info-text strong {
      color: var(--deep-charcoal);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      background: rgba(221, 226, 230, 0.3);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      flex-shrink: 0;
    }

    .toggle-switch.active {
      background: var(--primary-blue);
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--rich-white);
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .toggle-switch.active::after {
      left: 26px;
    }

    /* Light mode theme */
    body.light-mode {
      background: var(--rich-white);
      color: var(--deep-charcoal);
    }

    body.light-mode .app-header {
      background: var(--rich-white);
      color: var(--deep-charcoal);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    body.light-mode .app-header .tagline {
      color: var(--primary-blue);
    }

    body.light-mode .conversion-card {
      background: white;
      border: 1px solid var(--soft-grey);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    body.light-mode .payment-amount-input {
      background: white;
      border-color: var(--soft-grey);
      color: var(--deep-charcoal);
    }

    body.light-mode .payment-amount-input:focus {
      border-color: var(--primary-blue);
      background: white;
    }

    body.light-mode .payment-conversion-value {
      color: var(--soft-grey);
    }

    body.light-mode .output-value {
      color: var(--deep-charcoal);
    }

    body.light-mode .settings-modal-content {
      background: var(--rich-white);
      color: var(--deep-charcoal);
    }

    body.light-mode .settings-modal-header h2 {
      color: var(--deep-charcoal);
    }

    body.light-mode .settings-option {
      background: rgba(221, 226, 230, 0.2);
      border-color: var(--soft-grey);
    }

    body.light-mode .settings-option-label {
      color: var(--deep-charcoal);
    }

    body.light-mode .settings-select {
      background: white;
      border-color: var(--soft-grey);
      color: var(--deep-charcoal);
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 20px;
    }

    /* Center layout for phones, split layout for tablets */
    .conversion-wrapper {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    @media (min-width: 768px) {
      .conversion-wrapper {
        flex-direction: row;
        align-items: flex-start;
        gap: 32px;
      }

      .conversion-wrapper > * {
        flex: 1;
      }
    }

    .conversion-card {
      background: rgba(248, 249, 250, 0.05);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 20px;
      border: 1px solid rgba(221, 226, 230, 0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    /* ===== PAYMENT INPUT SECTION (Section 1) ===== */
    .payment-input-section {
      margin-bottom: 32px;
    }

    .payment-input-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-bottom: 12px;
      text-transform: none;
      letter-spacing: 0;
    }

    .payment-input-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .payment-currency-symbol {
      font-size: 32px;
      font-weight: 600;
      color: var(--glow-cyan);
      flex-shrink: 0;
      user-select: none;
      pointer-events: none;
    }

    .payment-amount-input {
      flex: 1;
      padding: 18px 20px;
      font-size: 32px;
      font-weight: 600;
      border: 2px solid rgba(221, 226, 230, 0.2);
      border-radius: 16px;
      background: rgba(248, 249, 250, 0.08);
      color: var(--rich-white);
      transition: all 0.3s ease;
      min-height: 56px; /* Exceeds 44px accessibility requirement */
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.1);
      touch-action: manipulation;
    }

    .payment-amount-input::placeholder {
      color: rgba(248, 249, 250, 0.3);
    }

    .payment-amount-input:focus {
      outline: none;
      border-color: var(--primary-blue);
      background: rgba(248, 249, 250, 0.12);
      box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
    }

    .payment-amount-input:focus-visible {
      outline: 2px solid var(--glow-cyan);
      outline-offset: 2px;
    }

    /* ===== PAYMENT CONVERSION SECTION (Section 2) ===== */
    .payment-conversion-section {
      margin-top: 32px;
      padding-top: 24px;
      border-top: 1px solid rgba(221, 226, 230, 0.15);
    }

    .payment-conversion-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-bottom: 8px;
      text-transform: none;
      letter-spacing: 0;
    }

    .payment-conversion-value {
      font-size: 20px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-top: 4px;
      opacity: 0;
      transform: translateY(5px);
      transition: all 0.3s ease;
      user-select: none;
      pointer-events: none;
    }

    .payment-conversion-value.visible {
      opacity: 1;
      transform: translateY(0);
    }

    #homeCurrencySymbol {
      margin-right: 4px;
    }

    /* Legacy output-value styles for compatibility */
    .output-group {
      margin-top: 32px;
      padding-top: 28px;
      border-top: 1px solid rgba(221, 226, 230, 0.15);
    }

    .output-group label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      color: var(--soft-grey);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .output-value {
      font-size: 40px;
      font-weight: 700;
      color: var(--rich-white);
      margin-top: 12px;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease;
      text-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
    }

    .output-value.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .output-value.live-rate {
      animation: conversionPulse 0.6s ease-out;
    }

    @keyframes conversionPulse {
      0% {
        transform: scale(1);
        text-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      }
      50% {
        transform: scale(1.05);
        text-shadow: 0 0 40px rgba(0, 240, 255, 0.5); /* Accent glow on pulse */
      }
      100% {
        transform: scale(1);
        text-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
      }
    }

    /* Exchange rate display */
    .exchange-rate {
      margin-top: 16px;
      padding: 12px 16px;
      background: rgba(0, 122, 255, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(0, 122, 255, 0.2);
      font-size: 13px;
      color: var(--soft-grey);
      display: flex;
      align-items: center;
      justify-content: space-between;
      opacity: 0;
      transform: translateY(5px);
      transition: all 0.3s ease 0.2s;
    }

    .exchange-rate.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .exchange-rate-label {
      font-weight: 500;
      color: var(--soft-grey);
    }

    .exchange-rate-value {
      font-weight: 600;
      color: var(--glow-cyan);
      font-size: 14px;
    }

    .exchange-rate-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 8px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 8px;
    }

    .exchange-rate-badge.live {
      background: var(--accent-green);
      color: white;
    }

    .exchange-rate-badge.cached {
      background: rgba(221, 226, 230, 0.3);
      color: var(--soft-grey);
    }

    .change-currency-btn {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      background: var(--primary-blue); /* #007AFF */
      color: var(--rich-white); /* #F8F9FA - high contrast white */
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 24px;
      box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
      /* Touch-optimized: minimum 44px height */
      min-height: 44px;
      -webkit-tap-highlight-color: rgba(0, 122, 255, 0.2);
      touch-action: manipulation;
    }

    .change-currency-btn:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(0, 122, 255, 0.2);
      background: #0056CC; /* Darker blue on press */
    }

    .change-currency-btn:hover {
      background: #0056CC;
      box-shadow: 0 6px 16px rgba(0, 122, 255, 0.4);
    }

    /* Focus state for accessibility */
    .change-currency-btn:focus-visible {
      outline: 2px solid var(--glow-cyan); /* #00F0FF */
      outline-offset: 2px;
    }

    .status-badge {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 13px;
      font-weight: 600;
      background: rgba(28, 28, 30, 0.9);
      color: var(--rich-white);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
      z-index: 100;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(221, 226, 230, 0.1);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-badge::before {
      content: '';
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: currentColor;
      display: inline-block;
    }

    .status-badge.online {
      background: rgba(48, 209, 88, 0.9);
      color: white;
    }

    .status-badge.offline {
      background: rgba(255, 59, 48, 0.9);
      color: white;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      .app-header {
        padding: 14px 16px;
        gap: 12px;
        min-height: 56px;
      }

      .app-header-icon {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
      }

      .app-header h1 {
        font-size: 22px;
      }

      .app-header .tagline {
        font-size: 12px;
      }

      .payment-amount-input {
        font-size: 28px;
        padding: 16px 18px;
        min-height: 44px;
      }

      .payment-currency-symbol {
        font-size: 28px;
      }

      .payment-conversion-value {
        font-size: 18px;
      }

      .output-value {
        font-size: 36px;
      }

      .conversion-card {
        padding: 24px;
      }

      .app-container {
        padding: 20px 16px;
      }

      .status-badge {
        bottom: 20px;
        padding: 10px 20px;
        font-size: 12px;
      }

      .settings-star-btn {
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
      }

      .settings-star-btn svg {
        width: 20px;
        height: 20px;
      }

      .settings-modal-content {
        padding: 24px;
      }

      .settings-modal-header h2 {
        font-size: 20px;
      }

      .location-permission-content {
        padding: 24px 20px;
      }

      .location-permission-title {
        font-size: 22px;
      }

      .location-permission-description {
        font-size: 15px;
      }

      .location-permission-disclaimer-text {
        font-size: 12px;
      }
    }

    @media (min-width: 481px) and (max-width: 767px) {
      .app-container {
        padding: 24px;
      }
    }

    @media (min-width: 768px) {
      .app-header {
        padding: 20px 32px;
        min-height: 72px;
      }

      .app-header-icon {
        width: 48px;
        height: 48px;
        min-width: 48px;
        min-height: 48px;
      }

      .app-header h1 {
        font-size: 28px;
      }

      .app-header .tagline {
        font-size: 14px;
      }

      .app-container {
        padding: 40px 32px;
      }

      .conversion-card {
        padding: 36px;
      }

      .payment-amount-input {
        font-size: 36px;
        padding: 20px 24px;
      }

      .payment-currency-symbol {
        font-size: 36px;
      }

      .payment-conversion-value {
        font-size: 22px;
      }

      .output-value {
        font-size: 48px;
      }

      .status-badge {
        bottom: 32px;
      }

      .settings-modal-content {
        max-width: 600px;
        padding: 32px;
      }
    }

    @media (min-width: 1024px) {
      .conversion-wrapper {
        max-width: 1000px;
        margin: 0 auto;
      }
    }
  </style>
</head>

<body>
  <!-- Splash Screen -->
  <div id="splashScreen">
    <div class="splash-container">
      <!-- Diagonal glowing slash -->
      <div class="diagonal-slash"></div>

      <!-- Currency symbols above and below -->
      <div class="currency-container">
        <div class="currency-top" id="currencyTop">
          <span class="currency-symbol">$</span>
          <span class="currency-symbol">€</span>
          <span class="currency-symbol">¥</span>
          <span class="currency-symbol">£</span>
          <span class="currency-symbol">₹</span>
        </div>
        <div class="currency-bottom" id="currencyBottom">
          <span class="currency-symbol">₩</span>
          <span class="currency-symbol">₽</span>
          <span class="currency-symbol">₪</span>
          <span class="currency-symbol">₱</span>
          <span class="currency-symbol">zł</span>
        </div>
      </div>

      <!-- App icon that zooms out and slides up -->
      <div class="splash-icon-container">
        <div class="splash-icon">
          <svg viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="var(--glow-cyan)" stroke-width="4" fill="none"/>
            <circle cx="100" cy="100" r="30" stroke="var(--glow-cyan)" stroke-width="4" fill="none"/>
          </svg>
        </div>
      </div>

      <!-- App name -->
      <div class="splash-app-name">Convertr</div>
    </div>

    <div class="splash-tagline">Know What It Costs.</div>
  </div>

  <!-- Main App -->
  <div id="mainApp">
    <header class="app-header">
      <!-- App icon in top left - light/dark variants -->
      <div class="app-header-icon" id="headerIcon" role="img" aria-label="Convertr app icon">
        <!-- Light icon (for light mode) -->
        <svg class="light-icon" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="#007AFF" stroke-width="4" fill="none"/>
          <circle cx="100" cy="100" r="30" stroke="#007AFF" stroke-width="4" fill="none"/>
        </svg>
        <!-- Dark icon (for dark mode) -->
        <svg class="dark-icon" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M100 50L150 100L100 150L50 100L100 50Z" stroke="#00F0FF" stroke-width="4" fill="none"/>
          <circle cx="100" cy="100" r="30" stroke="#00F0FF" stroke-width="4" fill="none"/>
        </svg>
      </div>
      <!-- App branding: title and subtitle -->
      <div class="app-header-content">
        <h1>Convertr</h1>
        <div class="tagline">Know What It Costs.</div>
      </div>
      <!-- Settings gear icon button in top right -->
      <button class="settings-star-btn" id="settingsStarBtn" aria-label="Open settings" title="Settings">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.364 6.364l-4.243-4.243m-4.242 0L5.636 17.364M18.364 5.636l-4.243 4.243m-4.242 0L5.636 6.636"></path>
        </svg>
      </button>
    </header>

    <!-- Location Permission Modal -->
    <div class="location-permission-modal" id="locationPermissionModal">
      <div class="location-permission-content">
        <div class="location-permission-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
        </div>
        <h2 class="location-permission-title">Location Access Needed</h2>
        <p class="location-permission-description">
          Convertr uses your location to automatically detect your local currency for accurate conversions.
        </p>
        <div class="location-permission-buttons">
          <button class="location-allow-btn" id="locationAllowBtn">Allow</button>
          <button class="location-skip-btn" id="locationSkipBtn">Skip for Now</button>
        </div>
        <div class="location-permission-disclaimer">
          <p class="location-permission-disclaimer-text">
            <strong>Privacy Notice:</strong> This app uses your device's location to provide accurate, automatic currency conversion. We do not collect, store, or send your location data anywhere — it stays on your device and is only used while the app is open. If you're not comfortable allowing location access, we recommend using another currency conversion app. Convertr is completely free and respects your privacy.
          </p>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
      <div class="settings-modal-content">
        <div class="settings-modal-header">
          <h2>Settings</h2>
          <button class="settings-modal-close" id="settingsModalClose" aria-label="Close settings">×</button>
        </div>

        <!-- Location Access Section -->
        <div class="settings-section">
          <div class="settings-section-title">Location Access</div>
          <div class="settings-option">
            <div>
              <div class="settings-option-label">Location Permission</div>
              <div class="settings-option-value" id="locationStatus">Not requested</div>
            </div>
            <button class="settings-btn" id="requestLocationBtn">Request Access</button>
          </div>
          <div class="settings-info-text">
            <strong>Privacy Notice:</strong> This app uses your device's location to provide accurate, automatic currency conversion. We do not collect, store, or send your location data anywhere — it stays on your device and is only used while the app is open. If you're not comfortable allowing location access, we recommend using another currency conversion app. Convertr is completely free and respects your privacy.
          </div>
        </div>

        <!-- Home Country Selection -->
        <div class="settings-section">
          <div class="settings-section-title">Home Country</div>
          <div class="settings-option">
            <div class="settings-option-label">Set Home Currency</div>
            <select class="settings-select" id="homeCountrySelect">
              <option value="USD">United States (USD)</option>
              <option value="EUR">Eurozone (EUR)</option>
              <option value="GBP">United Kingdom (GBP)</option>
              <option value="JPY">Japan (JPY)</option>
              <option value="AUD">Australia (AUD)</option>
              <option value="CAD">Canada (CAD)</option>
              <option value="CHF">Switzerland (CHF)</option>
              <option value="CNY">China (CNY)</option>
              <option value="INR">India (INR)</option>
              <option value="KRW">South Korea (KRW)</option>
              <option value="MXN">Mexico (MXN)</option>
              <option value="BRL">Brazil (BRL)</option>
              <option value="SGD">Singapore (SGD)</option>
              <option value="HKD">Hong Kong (HKD)</option>
              <option value="NZD">New Zealand (NZD)</option>
              <option value="SEK">Sweden (SEK)</option>
              <option value="NOK">Norway (NOK)</option>
              <option value="DKK">Denmark (DKK)</option>
              <option value="PLN">Poland (PLN)</option>
              <option value="RUB">Russia (RUB)</option>
              <option value="TRY">Turkey (TRY)</option>
              <option value="ZAR">South Africa (ZAR)</option>
              <option value="THB">Thailand (THB)</option>
              <option value="MYR">Malaysia (MYR)</option>
              <option value="IDR">Indonesia (IDR)</option>
              <option value="PHP">Philippines (PHP)</option>
              <option value="VND">Vietnam (VND)</option>
              <option value="ILS">Israel (ILS)</option>
            </select>
          </div>
        </div>

        <!-- Exchange Rate Update -->
        <div class="settings-section">
          <div class="settings-section-title">Exchange Rates</div>
          <div class="settings-option">
            <div>
              <div class="settings-option-label">Update Exchange Rates</div>
              <div class="settings-option-value" id="lastUpdateTime">Last updated: --</div>
            </div>
            <button class="settings-btn" id="updateRatesBtn">Update Now</button>
          </div>
        </div>

        <!-- Theme Toggle -->
        <div class="settings-section">
          <div class="settings-section-title">Appearance</div>
          <div class="settings-option">
            <div class="settings-option-label">Theme</div>
            <div class="theme-toggle">
              <span class="settings-option-value" id="themeLabel">Dark</span>
              <div class="toggle-switch" id="themeToggle"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="app-container">
      <div class="conversion-wrapper">
        <div class="conversion-card">
          <!-- SECTION 1: User Input -->
          <div class="payment-input-section">
            <label for="amountInput" class="payment-input-label" id="inputLabel">
              Amount to pay (Local currency – <span id="localCurrency">EUR</span>)
            </label>
            <div class="payment-input-wrapper">
              <span class="payment-currency-symbol" id="inputCurrencySymbol" aria-hidden="true">€</span>
              <input 
                type="text" 
                id="amountInput" 
                class="payment-amount-input" 
                placeholder="0.00"
                inputmode="decimal"
                autocomplete="off"
              />
            </div>
          </div>

          <!-- SECTION 2: Read-only Conversion -->
          <div class="payment-conversion-section">
            <div class="payment-conversion-label">Estimated card charge:</div>
            <div class="payment-conversion-value" id="outputValue">
              <span id="homeCurrencySymbol">AUD $</span><span id="convertedAmount">--</span>
            </div>
          </div>
          
          <!-- Hidden exchange rate display (removed from UI per requirements) -->
          <div class="exchange-rate" id="exchangeRate" style="display: none;">
            <span class="exchange-rate-label">Exchange Rate</span>
            <span>
              <span class="exchange-rate-value" id="exchangeRateValue">--</span>
              <span class="exchange-rate-badge cached" id="rateBadge">Cached</span>
            </span>
          </div>

          <button class="change-currency-btn" id="changeCurrencyBtn">
            Change Home Currency
          </button>
        </div>
      </div>
    </div>

    <div class="status-badge offline" id="statusBadge">Cached</div>
  </div>

  <script>
    // ===== STATE MANAGEMENT =====
    let homeCurrency = localStorage.getItem('homeCurrency') || 'AUD';
    let localCurrency = localStorage.getItem('localCurrency') || 'EUR';
    let isOnline = false;
    let failCount = 0;

    // Currency symbols mapping
    const currencySymbols = {
      'USD': '$', 'EUR': '€', 'GBP': '£', 'JPY': '¥', 'AUD': 'A$',
      'CAD': 'C$', 'CHF': 'Fr', 'CNY': '¥', 'INR': '₹', 'KRW': '₩',
      'MXN': '$', 'BRL': 'R$', 'SGD': 'S$', 'HKD': 'HK$', 'NZD': 'NZ$',
      'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr', 'PLN': 'zł', 'RUB': '₽',
      'TRY': '₺', 'ZAR': 'R', 'THB': '฿', 'MYR': 'RM', 'IDR': 'Rp',
      'PHP': '₱', 'VND': '₫', 'ILS': '₪'
    };

    // ===== SPLASH SCREEN ANIMATION =====
    function initializeSplashScreen() {
      const topContainer = document.getElementById('currencyTop');
      const bottomContainer = document.getElementById('currencyBottom');
      const topSymbols = ['$', '€', '¥', '£', '₹'];
      const bottomSymbols = ['₩', '₽', '₪', '₱', 'zł'];
      
      // Get final currency symbols
      const finalTopSymbol = currencySymbols[homeCurrency] || '$';
      const finalBottomSymbol = currencySymbols[localCurrency] || '€';
      
      // Initial display - show all symbols
      topContainer.innerHTML = topSymbols.map(s => 
        `<span class="currency-symbol">${s}</span>`
      ).join('');
      bottomContainer.innerHTML = bottomSymbols.map(s => 
        `<span class="currency-symbol">${s}</span>`
      ).join('');
      
      // Fade in all symbols first
      setTimeout(() => {
        const symbols = topContainer.querySelectorAll('.currency-symbol');
        symbols.forEach((sym, idx) => {
          sym.style.animationDelay = `${idx * 0.05}s`;
        });
        const bottomSymbols = bottomContainer.querySelectorAll('.currency-symbol');
        bottomSymbols.forEach((sym, idx) => {
          sym.style.animationDelay = `${idx * 0.05}s`;
        });
      }, 100);
      
      // Start shuffle animation after symbols appear (0.75s shuffle duration)
      setTimeout(() => {
        let shuffleCount = 0;
        const shuffleInterval = setInterval(() => {
          // Randomly shuffle visible symbols
          const topSymbolsShuffled = [...topSymbols].sort(() => Math.random() - 0.5);
          const bottomSymbolsShuffled = [...bottomSymbols].sort(() => Math.random() - 0.5);
          
          topContainer.innerHTML = topSymbolsShuffled.map(s => 
            `<span class="currency-symbol" style="opacity: 1;">${s}</span>`
          ).join('');
          bottomContainer.innerHTML = bottomSymbolsShuffled.map(s => 
            `<span class="currency-symbol" style="opacity: 1;">${s}</span>`
          ).join('');
          
          shuffleCount++;
          if (shuffleCount >= 5) { // 0.75s at 150ms intervals (5 * 150ms = 750ms)
            clearInterval(shuffleInterval);
            
            // Resolve to final currencies
            topContainer.innerHTML = `<span class="currency-symbol final" style="opacity: 1;">${finalTopSymbol}</span>`;
            bottomContainer.innerHTML = `<span class="currency-symbol final" style="opacity: 1;">${finalBottomSymbol}</span>`;
          }
        }, 150);
      }, 500); // Wait for initial fade-in to complete
      
      // Hide splash and show main app after animation completes
      // Timeline: 0.5s fade-in + 0.75s shuffle + 0.4s resolve + 0.5s glow + 1.2s zoom + 0.8s fade = ~4.15s
      setTimeout(() => {
        document.getElementById('splashScreen').classList.add('hidden');
        setTimeout(() => {
          document.getElementById('splashScreen').style.display = 'none';
          document.getElementById('mainApp').classList.add('visible');
        }, 600);
      }, 4800); // Total animation duration
    }

    // ===== LOCATION DETECTION =====
    let locationPermissionRequested = localStorage.getItem('locationPermissionRequested') === 'true';
    let locationPermissionGranted = false;

    // Check location permission status
    function checkLocationPermissionStatus() {
      if (!navigator.geolocation) {
        return 'not-supported';
      }
      
      // Note: Browsers don't provide a direct API to check permission status
      // We'll track it via localStorage and show status based on that
      const permission = localStorage.getItem('locationPermission');
      if (permission === 'granted') {
        return 'granted';
      } else if (permission === 'denied') {
        return 'denied';
      }
      return 'prompt';
    }

    // Update location status in settings
    function updateLocationStatus() {
      const statusEl = document.getElementById('locationStatus');
      const requestBtn = document.getElementById('requestLocationBtn');
      const status = checkLocationPermissionStatus();
      
      if (status === 'not-supported') {
        statusEl.textContent = 'Not supported';
        requestBtn.disabled = true;
        requestBtn.textContent = 'Not Available';
      } else if (status === 'granted') {
        statusEl.textContent = 'Granted';
        requestBtn.textContent = 'Access Granted';
        requestBtn.disabled = true;
        requestBtn.style.background = 'var(--accent-green)';
      } else if (status === 'denied') {
        statusEl.textContent = 'Denied';
        requestBtn.textContent = 'Request Again';
        requestBtn.disabled = false;
      } else {
        statusEl.textContent = 'Not requested';
        requestBtn.textContent = 'Request Access';
        requestBtn.disabled = false;
      }
    }

    // Show location permission modal
    function showLocationPermissionModal() {
      const modal = document.getElementById('locationPermissionModal');
      modal.classList.add('active');
    }

    // Close location permission modal
    function closeLocationPermissionModal() {
      const modal = document.getElementById('locationPermissionModal');
      modal.classList.remove('active');
    }

    // Reverse geocoding to get country from coordinates
    async function getCountryFromCoordinates(lat, lon) {
      try {
        // Using OpenStreetMap Nominatim API (free, no API key required)
        const response = await fetch(
          `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=3&addressdetails=1`,
          {
            headers: {
              'User-Agent': 'Convertr Currency App' // Required by Nominatim
            }
          }
        );
        
        if (!response.ok) {
          throw new Error('Reverse geocoding failed');
        }
        
        const data = await response.json();
        const countryCode = data.address?.country_code?.toUpperCase();
        return countryCode;
      } catch (error) {
        console.error('Reverse geocoding error:', error);
        return null;
      }
    }

    // Country code to currency mapping
    const countryCodeToCurrency = {
      'US': 'USD', 'GB': 'GBP', 'JP': 'JPY', 'AU': 'AUD',
      'CA': 'CAD', 'CH': 'CHF', 'CN': 'CNY', 'IN': 'INR',
      'KR': 'KRW', 'MX': 'MXN', 'BR': 'BRL', 'SG': 'SGD',
      'HK': 'HKD', 'NZ': 'NZD', 'SE': 'SEK', 'NO': 'NOK',
      'DK': 'DKK', 'PL': 'PLN', 'RU': 'RUB', 'TR': 'TRY',
      'ZA': 'ZAR', 'TH': 'THB', 'MY': 'MYR', 'ID': 'IDR',
      'PH': 'PHP', 'VN': 'VND', 'IL': 'ILS', 'DE': 'EUR',
      'FR': 'EUR', 'IT': 'EUR', 'ES': 'EUR', 'NL': 'EUR',
      'BE': 'EUR', 'AT': 'EUR', 'PT': 'EUR', 'IE': 'EUR',
      'FI': 'EUR', 'GR': 'EUR', 'LU': 'EUR'
    };

    // Request location permission
    async function requestLocationPermission() {
      if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser.');
        return;
      }

      try {
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            timeout: 15000,
            enableHighAccuracy: false
          });
        });

        // Get coordinates
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        // Get country from coordinates using reverse geocoding
        const countryCode = await getCountryFromCoordinates(lat, lon);
        
        if (countryCode && countryCodeToCurrency[countryCode]) {
          localCurrency = countryCodeToCurrency[countryCode];
        } else {
          // Fallback to browser locale if reverse geocoding fails
          const locale = navigator.language || 'en-US';
          const region = locale.split('-')[1] || 'US';
          localCurrency = countryCodeToCurrency[region] || 'USD';
        }

        localStorage.setItem('localCurrency', localCurrency);
        localStorage.setItem('locationPermission', 'granted');
        locationPermissionGranted = true;
        updateCurrencyLabels();
        updateLocationStatus();
        closeLocationPermissionModal();
      } catch (error) {
        console.error('Location permission error:', error);
        if (error.code === error.PERMISSION_DENIED) {
          localStorage.setItem('locationPermission', 'denied');
          updateLocationStatus();
        }
        closeLocationPermissionModal();
        // Fall back to browser locale
        await detectLocalCurrencyFallback();
      }
    }

    // Fallback currency detection using browser locale
    async function detectLocalCurrencyFallback() {
      try {
        const locale = navigator.language || 'en-US';
        const region = locale.split('-')[1] || 'US';
        
        const detected = countryCodeToCurrency[region] || 'USD';
        localCurrency = detected;
        localStorage.setItem('localCurrency', localCurrency);
        updateCurrencyLabels();
      } catch (error) {
        console.error('Currency detection failed:', error);
      }
    }

    async function detectLocalCurrency() {
      // Check if permission was already requested
      if (!locationPermissionRequested) {
        // Show permission modal after a short delay (after splash screen)
        setTimeout(() => {
          showLocationPermissionModal();
          locationPermissionRequested = true;
          localStorage.setItem('locationPermissionRequested', 'true');
        }, 5000); // Show after splash screen completes
      } else {
        // Permission was already requested, use fallback
        await detectLocalCurrencyFallback();
      }
    }

    // ===== CONNECTIVITY CHECKING =====
    async function probeInternet() {
      try {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 2500);

        const response = await fetch("./healthcheck.txt?t=" + Date.now(), {
          cache: "no-store",
          signal: controller.signal
        });

        clearTimeout(timeoutId);

        if (response.ok) {
          const text = await response.text();
          if (text.toLowerCase().includes("ok")) {
            return true;
          }
        }
        return false;
      } catch (error) {
        return false;
      }
    }

    async function updateConnectivity(reason) {
      if (!navigator.onLine) {
        isOnline = false;
        failCount = 0;
        updateStatusBadge('offline');
        return;
      }

      const ok = await probeInternet();
      if (ok) {
        isOnline = true;
        failCount = 0;
        updateStatusBadge('online');
      } else {
        failCount++;
        if (failCount >= 2) {
          isOnline = false;
          updateStatusBadge('offline');
        }
      }
    }

    function updateStatusBadge(status) {
      const badge = document.getElementById('statusBadge');
      badge.className = `status-badge ${status}`;
      badge.textContent = status === 'online' ? 'Online' : 'Cached';
      
      // Update exchange rate badge if conversion is displayed
      if (currentExchangeRate !== null) {
        const rateBadgeEl = document.getElementById('rateBadge');
        if (status === 'online') {
          rateBadgeEl.textContent = 'Live';
          rateBadgeEl.className = 'exchange-rate-badge live';
        } else {
          rateBadgeEl.textContent = 'Cached';
          rateBadgeEl.className = 'exchange-rate-badge cached';
        }
      }
    }

    // ===== CURRENCY CONVERSION =====
    let currentExchangeRate = null;
    let lastConversionTime = null;

    function updateCurrencyLabels() {
      document.getElementById('localCurrency').textContent = localCurrency;
      // Update input currency symbol (outside input)
      const inputSymbolEl = document.getElementById('inputCurrencySymbol');
      if (inputSymbolEl) {
        inputSymbolEl.textContent = currencySymbols[localCurrency] || localCurrency;
      }
      // Update home currency symbol for conversion display
      const homeSymbolEl = document.getElementById('homeCurrencySymbol');
      if (homeSymbolEl) {
        homeSymbolEl.textContent = `${homeCurrency} ${currencySymbols[homeCurrency] || '$'}`;
      }
      // Update aria-labels for accessibility
      const amountInput = document.getElementById('amountInput');
      if (amountInput) {
        const localCurrencyName = localCurrency === 'EUR' ? 'euros' :
                                  localCurrency === 'USD' ? 'US dollars' :
                                  localCurrency === 'GBP' ? 'British pounds' :
                                  localCurrency === 'JPY' ? 'Japanese yen' :
                                  localCurrency === 'AUD' ? 'Australian dollars' : `${localCurrency} dollars`;
        amountInput.setAttribute('aria-label', `Amount to pay, local currency, ${localCurrencyName}`);
      }
      const outputValueEl = document.getElementById('outputValue');
      if (outputValueEl) {
        const homeCurrencyName = homeCurrency === 'AUD' ? 'Australian dollars' : 
                                 homeCurrency === 'USD' ? 'US dollars' :
                                 homeCurrency === 'EUR' ? 'euros' :
                                 homeCurrency === 'GBP' ? 'British pounds' :
                                 homeCurrency === 'JPY' ? 'Japanese yen' : `${homeCurrency} dollars`;
        outputValueEl.setAttribute('aria-label', `Estimated card charge, ${homeCurrencyName}`);
      }
    }

    // Update exchange rate display (hidden from UI per requirements)
    function updateExchangeRateDisplay(fromRate, toRate, isLive = false) {
      // Exchange rate display removed from UI - kept for internal tracking only
      if (!fromRate || !toRate) {
        return;
      }
      // Calculate exchange rate (1 unit of local currency = X units of home currency)
      const rate = toRate / fromRate;
      currentExchangeRate = rate;
    }

    async function convertCurrency(amount) {
      const convertedAmountEl = document.getElementById('convertedAmount');
      const conversionValueEl = document.getElementById('outputValue');
      
      // Handle empty or invalid input
      if (!amount || amount === '' || isNaN(parseFloat(amount)) || parseFloat(amount) <= 0) {
        if (convertedAmountEl) {
          convertedAmountEl.textContent = '--';
        }
        if (conversionValueEl) {
          conversionValueEl.classList.remove('visible');
        }
        return;
      }

      // Parse the amount (handle commas, spaces, etc.)
      const numericAmount = parseFloat(String(amount).replace(/[,\s]/g, ''));
      
      if (isNaN(numericAmount) || numericAmount <= 0) {
        if (convertedAmountEl) {
          convertedAmountEl.textContent = '--';
        }
        if (conversionValueEl) {
          conversionValueEl.classList.remove('visible');
        }
        return;
      }

      // TODO: Replace with actual exchange rate API
      // For now, using placeholder rates - in production, fetch from API like:
      // const response = await fetch(`https://api.exchangerate-api.com/v4/latest/USD`);
      // const data = await response.json();
      // const rates = data.rates;
      const rates = {
        'USD': 1.0,
        'EUR': 0.92,
        'GBP': 0.79,
        'JPY': 149.5,
        'AUD': 1.52,
        'CAD': 1.35,
        'CHF': 0.88,
        'CNY': 7.23,
        'INR': 83.12,
        'KRW': 1312.5,
        'MXN': 17.05,
        'BRL': 4.95,
        'SGD': 1.34,
        'HKD': 7.82,
        'NZD': 1.64,
        'SEK': 10.45,
        'NOK': 10.78,
        'DKK': 6.85,
        'PLN': 4.02,
        'RUB': 91.5,
        'TRY': 32.15,
        'ZAR': 18.75,
        'THB': 35.5,
        'MYR': 4.68,
        'IDR': 15650,
        'PHP': 55.8,
        'VND': 24350,
        'ILS': 3.65
      };

      const fromRate = rates[localCurrency] || 1.0;
      const toRate = rates[homeCurrency] || 1.0;

      if (!fromRate || !toRate) {
        if (convertedAmountEl) {
          convertedAmountEl.textContent = '--';
        }
        if (conversionValueEl) {
          conversionValueEl.classList.remove('visible');
        }
        return;
      }

      // Convert: local currency -> USD -> home currency
      const amountInUSD = numericAmount / fromRate;
      const converted = amountInUSD * toRate;

      // Update conversion display (read-only section)
      if (convertedAmountEl) {
        convertedAmountEl.textContent = converted.toFixed(2);
      }
      
      // Remove previous animation classes
      if (conversionValueEl) {
        conversionValueEl.classList.remove('visible');
        
        // Trigger reflow to restart animation
        void conversionValueEl.offsetWidth;
        
        // Add fade-in animation
        setTimeout(() => {
          conversionValueEl.classList.add('visible');
        }, 10);
      }

      lastConversionTime = Date.now();
    }

    // ===== SETTINGS FUNCTIONALITY =====
    let isLightMode = localStorage.getItem('theme') === 'light';

    // Initialize theme
    function initializeTheme() {
      if (isLightMode) {
        document.body.classList.add('light-mode');
        document.getElementById('themeToggle').classList.add('active');
        document.getElementById('themeLabel').textContent = 'Light';
      } else {
        document.body.classList.remove('light-mode');
        document.getElementById('themeToggle').classList.remove('active');
        document.getElementById('themeLabel').textContent = 'Dark';
      }
    }

    // Toggle theme
    function toggleTheme() {
      isLightMode = !isLightMode;
      localStorage.setItem('theme', isLightMode ? 'light' : 'dark');
      initializeTheme();
    }

    // Open settings modal
    function openSettingsModal() {
      const modal = document.getElementById('settingsModal');
      modal.classList.add('active');
      // Set current home currency in select
      document.getElementById('homeCountrySelect').value = homeCurrency;
      // Update last update time
      updateLastUpdateTime();
      // Update location status
      updateLocationStatus();
    }

    // Close settings modal
    function closeSettingsModal() {
      const modal = document.getElementById('settingsModal');
      modal.classList.remove('active');
    }

    // Update last update time display
    function updateLastUpdateTime() {
      const lastUpdateEl = document.getElementById('lastUpdateTime');
      const lastUpdate = localStorage.getItem('lastExchangeRateUpdate');
      if (lastUpdate) {
        const date = new Date(parseInt(lastUpdate));
        lastUpdateEl.textContent = `Last updated: ${date.toLocaleString()}`;
      } else {
        lastUpdateEl.textContent = 'Last updated: Never';
      }
    }

    // Update exchange rates
    async function updateExchangeRates() {
      const updateBtn = document.getElementById('updateRatesBtn');
      const originalText = updateBtn.textContent;
      
      if (!isOnline) {
        alert('You need to be online to update exchange rates.');
        return;
      }

      updateBtn.disabled = true;
      updateBtn.textContent = 'Updating...';

      try {
        // TODO: Replace with actual exchange rate API call
        // Example: const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        // const data = await response.json();
        // Store rates in localStorage
        
        // Simulate API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // Store update time
        localStorage.setItem('lastExchangeRateUpdate', Date.now().toString());
        updateLastUpdateTime();
        
        // Show success feedback
        updateBtn.textContent = 'Updated!';
        setTimeout(() => {
          updateBtn.textContent = originalText;
          updateBtn.disabled = false;
        }, 2000);

        // Recalculate conversion if there's an amount entered
        const amountInput = document.getElementById('amountInput');
        if (amountInput.value) {
          convertCurrency(parseFloat(amountInput.value));
        }
      } catch (error) {
        console.error('Failed to update exchange rates:', error);
        updateBtn.textContent = 'Update Failed';
        setTimeout(() => {
          updateBtn.textContent = originalText;
          updateBtn.disabled = false;
        }, 2000);
      }
    }

    // Change home currency
    function changeHomeCurrency() {
      const newCurrency = document.getElementById('homeCountrySelect').value;
      if (newCurrency !== homeCurrency) {
        homeCurrency = newCurrency;
        localStorage.setItem('homeCurrency', homeCurrency);
        updateCurrencyLabels();
        
        // Recalculate conversion if there's an amount entered
        const amountInput = document.getElementById('amountInput');
        if (amountInput.value) {
          convertCurrency(parseFloat(amountInput.value));
        }
      }
    }

    // ===== EVENT LISTENERS =====
    // Restrict input to numbers only (with decimal point)
    const amountInput = document.getElementById('amountInput');
    
    // Only allow numbers and decimal point
    amountInput.addEventListener('input', (e) => {
      let value = e.target.value;
      // Remove any non-numeric characters except decimal point
      value = value.replace(/[^0-9.]/g, '');
      // Ensure only one decimal point
      const parts = value.split('.');
      if (parts.length > 2) {
        value = parts[0] + '.' + parts.slice(1).join('');
      }
      // Update input value
      if (e.target.value !== value) {
        e.target.value = value;
      }
      
      // Convert immediately on each keystroke
      convertCurrency(value);
    });

    // Handle paste events - sanitize pasted content
    amountInput.addEventListener('paste', (e) => {
      e.preventDefault();
      const pastedText = (e.clipboardData || window.clipboardData).getData('text');
      // Clean pasted text to only allow numbers and decimal point
      let cleaned = pastedText.replace(/[^0-9.]/g, '');
      const parts = cleaned.split('.');
      if (parts.length > 2) {
        cleaned = parts[0] + '.' + parts.slice(1).join('');
      }
      // Set cursor position after pasted content
      const start = e.target.selectionStart || 0;
      const end = e.target.selectionEnd || 0;
      const currentValue = e.target.value;
      const newValue = currentValue.substring(0, start) + cleaned + currentValue.substring(end);
      e.target.value = newValue;
      // Position cursor after pasted content
      const newCursorPos = start + cleaned.length;
      setTimeout(() => {
        e.target.setSelectionRange(newCursorPos, newCursorPos);
        convertCurrency(newValue);
      }, 10);
    });

    // Ensure cursor starts inside the input field (not before currency symbol)
    amountInput.addEventListener('focus', (e) => {
      // If input is empty, cursor is already in the right place
      // If input has value, ensure cursor is at the end
      if (e.target.value) {
        setTimeout(() => {
          e.target.setSelectionRange(e.target.value.length, e.target.value.length);
        }, 0);
      }
    });

    document.getElementById('changeCurrencyBtn').addEventListener('click', () => {
      openSettingsModal();
    });

    // Settings modal handlers
    document.getElementById('settingsStarBtn').addEventListener('click', openSettingsModal);
    document.getElementById('settingsModalClose').addEventListener('click', closeSettingsModal);
    document.getElementById('settingsModal').addEventListener('click', (e) => {
      if (e.target.id === 'settingsModal') {
        closeSettingsModal();
      }
    });

    // Settings options handlers
    document.getElementById('homeCountrySelect').addEventListener('change', changeHomeCurrency);
    document.getElementById('updateRatesBtn').addEventListener('click', updateExchangeRates);
    document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    document.getElementById('requestLocationBtn').addEventListener('click', () => {
      closeSettingsModal();
      showLocationPermissionModal();
    });

    // Location permission modal handlers
    document.getElementById('locationAllowBtn').addEventListener('click', requestLocationPermission);
    document.getElementById('locationSkipBtn').addEventListener('click', () => {
      closeLocationPermissionModal();
      detectLocalCurrencyFallback();
    });

    // Close location modal on backdrop click
    document.getElementById('locationPermissionModal').addEventListener('click', (e) => {
      if (e.target.id === 'locationPermissionModal') {
        closeLocationPermissionModal();
        detectLocalCurrencyFallback();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeSettingsModal();
      }
    });

    window.addEventListener("online", () => updateConnectivity("event-online"));
    window.addEventListener("offline", () => updateConnectivity("event-offline"));

    // ===== INITIALIZATION =====
    async function initializeApp() {
      // Initialize theme
      initializeTheme();
      
      // Detect local currency
      await detectLocalCurrency();
      
      // Update UI
      updateCurrencyLabels();
      
      // Initialize connectivity
      updateConnectivity("startup");
      setInterval(() => updateConnectivity("poll"), 10000);
      
      // Initialize splash screen
      initializeSplashScreen();
    }

    // Start app when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
